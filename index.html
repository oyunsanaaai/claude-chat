<!DOCTYPE html>
<html lang="mn">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Claude AI –ß–∞—Ç</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif;
      background: #f5f5f5;
      color: #1a1a1a;
    }

    .header {
      background: white;
      border-bottom: 1px solid #e0e0e0;
      padding: 1rem 1.5rem;
      box-shadow: 0 2px 4px rgba(0,0,0,0.05);
    }

    .header-content {
      max-width: 1200px;
      margin: 0 auto;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .logo {
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }

    .logo-icon {
      width: 40px;
      height: 40px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.5rem;
    }

    .logo-text h1 {
      font-size: 1.25rem;
      font-weight: 700;
    }

    .logo-text p {
      font-size: 0.75rem;
      color: #666;
    }

    .header-buttons {
      display: flex;
      gap: 0.5rem;
    }

    .btn {
      padding: 0.5rem;
      background: transparent;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 1.25rem;
      transition: background 0.2s;
    }

    .btn:hover {
      background: #f0f0f0;
    }

    .messages-container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 2rem 1rem;
      height: calc(100vh - 200px);
      overflow-y: auto;
    }

    .empty-state {
      text-align: center;
      padding: 3rem 1rem;
    }

    .empty-state-icon {
      font-size: 4rem;
      margin-bottom: 1rem;
    }

    .empty-state h2 {
      font-size: 1.5rem;
      margin-bottom: 0.5rem;
    }

    .empty-state p {
      color: #666;
      margin-bottom: 2rem;
    }

    .suggestions {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 1rem;
      max-width: 800px;
      margin: 0 auto;
    }

    .suggestion-card {
      background: white;
      padding: 1.5rem;
      border-radius: 12px;
      border: 1px solid #e0e0e0;
      cursor: pointer;
      transition: all 0.2s;
    }

    .suggestion-card:hover {
      border-color: #667eea;
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.15);
    }

    .suggestion-icon {
      font-size: 2rem;
      margin-bottom: 0.5rem;
    }

    .message {
      display: flex;
      gap: 1rem;
      margin-bottom: 1.5rem;
      animation: fadeIn 0.3s ease-out;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .message.user {
      flex-direction: row-reverse;
    }

    .message-avatar {
      width: 36px;
      height: 36px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
    }

    .message.user .message-avatar {
      background: #3b82f6;
    }

    .message.assistant .message-avatar {
      background: #667eea;
    }

    .message.error .message-avatar {
      background: #ef4444;
    }

    .message-content {
      flex: 1;
      max-width: 700px;
    }

    .message-bubble {
      background: white;
      padding: 1rem 1.25rem;
      border-radius: 16px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.08);
    }

    .message.error .message-bubble {
      border: 2px solid #ef4444;
    }

    .message-text {
      white-space: pre-wrap;
      word-wrap: break-word;
      line-height: 1.6;
    }

    .message-time {
      font-size: 0.75rem;
      color: #999;
      margin-top: 0.5rem;
    }

    .code-block {
      background: #1e293b;
      color: #e2e8f0;
      padding: 1rem;
      border-radius: 8px;
      overflow-x: auto;
      margin: 1rem 0;
      font-family: 'Courier New', monospace;
      font-size: 0.875rem;
    }

    .code-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0.5rem 1rem;
      background: #334155;
      border-radius: 8px 8px 0 0;
      margin-top: 1rem;
    }

    .code-lang {
      font-size: 0.75rem;
      color: #94a3b8;
    }

    .copy-btn {
      background: transparent;
      border: none;
      color: #818cf8;
      cursor: pointer;
      font-size: 0.75rem;
      padding: 0.25rem 0.5rem;
    }

    .copy-btn:hover {
      color: #a5b4fc;
    }

    .input-container {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: white;
      border-top: 1px solid #e0e0e0;
      padding: 1rem;
      box-shadow: 0 -2px 10px rgba(0,0,0,0.05);
    }

    .input-wrapper {
      max-width: 1200px;
      margin: 0 auto;
      display: flex;
      gap: 0.75rem;
    }

    .input-field {
      flex: 1;
      padding: 1rem 1.25rem;
      border: 2px solid #e0e0e0;
      border-radius: 12px;
      font-size: 1rem;
      font-family: inherit;
      resize: none;
      transition: border-color 0.2s;
    }

    .input-field:focus {
      outline: none;
      border-color: #667eea;
    }

    .send-btn {
      background: #667eea;
      color: white;
      border: none;
      padding: 1rem 1.5rem;
      border-radius: 12px;
      font-size: 1.5rem;
      cursor: pointer;
      transition: background 0.2s;
    }

    .send-btn:hover {
      background: #5568d3;
    }

    .send-btn:disabled {
      background: #ccc;
      cursor: not-allowed;
    }

    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0,0,0,0.5);
      z-index: 1000;
      align-items: center;
      justify-content: center;
      padding: 1rem;
    }

    .modal.show {
      display: flex;
    }

    .modal-content {
      background: white;
      padding: 2rem;
      border-radius: 16px;
      max-width: 500px;
      width: 100%;
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
    }

    .modal-content h2 {
      margin-bottom: 1.5rem;
    }

    .modal-content label {
      display: block;
      margin-bottom: 0.5rem;
      font-weight: 600;
      color: #666;
    }

    .modal-content input {
      width: 100%;
      padding: 0.75rem 1rem;
      border: 2px solid #e0e0e0;
      border-radius: 8px;
      font-size: 1rem;
      margin-bottom: 1rem;
    }

    .modal-content input:focus {
      outline: none;
      border-color: #667eea;
    }

    .modal-hint {
      font-size: 0.75rem;
      color: #999;
      margin-bottom: 1.5rem;
    }

    .modal-buttons {
      display: flex;
      gap: 0.75rem;
    }

    .modal-btn {
      flex: 1;
      padding: 0.875rem;
      border: none;
      border-radius: 8px;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
    }

    .modal-btn.primary {
      background: #667eea;
      color: white;
    }

    .modal-btn.primary:hover {
      background: #5568d3;
    }

    .modal-btn.secondary {
      background: #e0e0e0;
      color: #333;
    }

    .modal-btn.secondary:hover {
      background: #d0d0d0;
    }

    .loading {
      display: inline-block;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      from { transform: rotate(0deg); }
      to { transform: rotate(360deg); }
    }

    @media (max-width: 768px) {
      .suggestions {
        grid-template-columns: 1fr;
      }
      
      .message-bubble {
        max-width: 85vw;
      }
    }
  </style>
</head>
<body>
  <!-- Header -->
  <div class="header">
    <div class="header-content">
      <div class="logo">
        <div class="logo-icon">ü§ñ</div>
        <div class="logo-text">
          <h1>Claude AI –ß–∞—Ç</h1>
          <p id="status">üü¢ –ë—ç–ª—ç–Ω</p>
        </div>
      </div>
      <div class="header-buttons">
        <button class="btn" onclick="toggleTheme()" id="themeBtn" title="–ó–∞–≥–≤–∞—Ä —Å–æ–ª–∏—Ö">üåô</button>
        <button class="btn" onclick="clearChat()" title="–¶—ç–≤—ç—Ä–ª—ç—Ö">üóëÔ∏è</button>
        <button class="btn" onclick="openSettings()" title="–¢–æ—Ö–∏—Ä–≥–æ–æ">‚öôÔ∏è</button>
      </div>
    </div>
  </div>

  <!-- Messages -->
  <div class="messages-container" id="messages">
    <div class="empty-state" id="emptyState">
      <div class="empty-state-icon">ü§ñ</div>
      <h2>Claude AI-—Ç–∞–π —á–∞—Ç–ª–∞—Ö</h2>
      <p>–ê—Å—É—É–ª—Ç –∞—Å—É—É–∂ —ç—Ö–ª—ç—ç—Ä—ç–π</p>
      <div class="suggestions">
        <div class="suggestion-card" onclick="setMessage('JavaScript –∫–æ–¥ –±–∏—á')">
          <div class="suggestion-icon">üíª</div>
          <h3>–ö–æ–¥ –±–∏—á–∏—Ö</h3>
          <p>–ü—Ä–æ–≥—Ä–∞–º —Ö”©–≥–∂“Ø“Ø–ª—ç—Ö</p>
        </div>
        <div class="suggestion-card" onclick="setMessage('–ú–æ–Ω–≥–æ–ª —Ö—ç–ª —Ä“Ø“Ø –æ—Ä—á—É—É–ª–∂ ”©–≥')">
          <div class="suggestion-icon">üåç</div>
          <h3>–û—Ä—á—É—É–ª–∞—Ö</h3>
          <p>–¢–µ–∫—Å—Ç –æ—Ä—á—É—É–ª–∞–ª—Ç</p>
        </div>
        <div class="suggestion-card" onclick="setMessage('–≠–Ω—ç —Ç–∞–ª–∞–∞—Ä —Ç–∞–π–ª–±–∞—Ä–ª–∞–∂ ”©–≥')">
          <div class="suggestion-icon">üìö</div>
          <h3>–¢–∞–π–ª–±–∞—Ä–ª–∞—Ö</h3>
          <p>–ú—ç–¥–ª—ç–≥ –∞–≤–∞—Ö</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Input -->
  <div class="input-container">
    <div class="input-wrapper">
      <textarea 
        id="messageInput"
        class="input-field"
        placeholder="–ú–µ—Å—Å–µ–∂ –±–∏—á–∏—Ö... (Enter - –∏–ª–≥—ç—ç—Ö, Shift+Enter - —à–∏–Ω—ç –º”©—Ä)"
        rows="1"
        onkeydown="handleKeyPress(event)"
        oninput="autoResize(this)"
      ></textarea>
      <button id="sendBtn" class="send-btn" onclick="sendMessage()">üì§</button>
    </div>
  </div>

  <!-- Settings Modal -->
  <div class="modal" id="settingsModal">
    <div class="modal-content">
      <h2>‚öôÔ∏è –¢–æ—Ö–∏—Ä–≥–æ–æ</h2>
      <label>Cloudflare Worker URL</label>
      <input 
        type="text" 
        id="workerUrlInput"
        placeholder="https://your-worker.workers.dev"
      />
      <div class="modal-hint">
        üìç Cloudflare Worker-—ã–Ω URL —Ö–∞—è–≥ –æ—Ä—É—É–ª–Ω–∞ —É—É
      </div>
      <div class="modal-buttons">
        <button class="modal-btn primary" onclick="saveSettings()">‚úì –•–∞–¥–≥–∞–ª–∞—Ö</button>
        <button class="modal-btn secondary" onclick="closeSettings()">–•–∞–∞—Ö</button>
      </div>
    </div>
  </div>

  <script>
    let messages = [];
    let workerUrl = '';
    let theme = 'light';
    let loading = false;

    // –≠—Ö–ª“Ø“Ø–ª—ç—Ö
    window.onload = function() {
      workerUrl = localStorage.getItem('worker_url') || '';
      theme = localStorage.getItem('claude_theme') || 'light';
      const savedMessages = localStorage.getItem('claude_messages');
      
      if (savedMessages) {
        try {
          messages = JSON.parse(savedMessages);
          renderMessages();
        } catch (e) {
          console.error('Message load error:', e);
        }
      }
      
      if (!workerUrl) {
        setTimeout(() => openSettings(), 500);
      }
      
      applyTheme();
    };

    function toggleTheme() {
      theme = theme === 'light' ? 'dark' : 'light';
      localStorage.setItem('claude_theme', theme);
      applyTheme();
    }

    function applyTheme() {
      document.body.style.background = theme === 'dark' ? '#1a1a1a' : '#f5f5f5';
      document.body.style.color = theme === 'dark' ? '#fff' : '#1a1a1a';
      document.getElementById('themeBtn').textContent = theme === 'dark' ? '‚òÄÔ∏è' : 'üåô';
    }

    function openSettings() {
      document.getElementById('settingsModal').classList.add('show');
      document.getElementById('workerUrlInput').value = workerUrl;
    }

    function closeSettings() {
      document.getElementById('settingsModal').classList.remove('show');
    }

    function saveSettings() {
      const input = document.getElementById('workerUrlInput').value.trim();
      if (!input.startsWith('https://')) {
        alert('‚ö†Ô∏è URL –±—É—Ä—É—É –±–∞–π–Ω–∞! https:// –≥—ç–∂ —ç—Ö–ª—ç—Ö —ë—Å—Ç–æ–π.');
        return;
      }
      workerUrl = input;
      localStorage.setItem('worker_url', workerUrl);
      closeSettings();
      alert('‚úÖ –•–∞–¥–≥–∞–ª–∞–≥–¥–ª–∞–∞!');
    }

    function setMessage(text) {
      document.getElementById('messageInput').value = text;
      document.getElementById('messageInput').focus();
    }

    function autoResize(textarea) {
      textarea.style.height = 'auto';
      textarea.style.height = Math.min(textarea.scrollHeight, 200) + 'px';
    }

    function handleKeyPress(event) {
      if (event.key === 'Enter' && !event.shiftKey) {
        event.preventDefault();
        sendMessage();
      }
    }

    async function sendMessage() {
      const input = document.getElementById('messageInput');
      const userMessage = input.value.trim();
      
      if (!userMessage || loading) return;
      
      if (!workerUrl) {
        alert('‚ö†Ô∏è Cloudflare Worker URL –æ—Ä—É—É–ª–Ω–∞ —É—É!');
        openSettings();
        return;
      }

      loading = true;
      document.getElementById('sendBtn').disabled = true;
      document.getElementById('sendBtn').innerHTML = '<span class="loading">‚è≥</span>';
      document.getElementById('emptyState').style.display = 'none';
      
      messages.push({
        role: 'user',
        content: userMessage,
        timestamp: new Date().toISOString()
      });
      
      input.value = '';
      input.style.height = 'auto';
      renderMessages();
      
      try {
        const response = await fetch(workerUrl, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            messages: messages.map(msg => ({
              role: msg.role,
              content: msg.content
            }))
          })
        });

        const data = await response.json();
        
        if (!response.ok) {
          throw new Error(data.error || '–ê–ª–¥–∞–∞ –≥–∞—Ä–ª–∞–∞');
        }

        messages.push({
          role: 'assistant',
          content: data.content[0].text,
          timestamp: new Date().toISOString()
        });
        
        localStorage.setItem('claude_messages', JSON.stringify(messages));
        renderMessages();

      } catch (error) {
        messages.push({
          role: 'assistant',
          content: `‚ùå –ê–ª–¥–∞–∞: ${error.message}`,
          timestamp: new Date().toISOString(),
          error: true
        });
        renderMessages();
      } finally {
        loading = false;
        document.getElementById('sendBtn').disabled = false;
        document.getElementById('sendBtn').innerHTML = 'üì§';
      }
    }

    function formatMessage(content) {
      const codeRegex = /```(\w+)?\n([\s\S]*?)```/g;
      let parts = [];
      let lastIndex = 0;
      let match;

      while ((match = codeRegex.exec(content)) !== null) {
        if (match.index > lastIndex) {
          parts.push({ type: 'text', content: content.slice(lastIndex, match.index) });
        }
        parts.push({ 
          type: 'code', 
          language: match[1] || 'code',
          content: match[2].trim() 
        });
        lastIndex = match.index + match[0].length;
      }

      if (lastIndex < content.length) {
        parts.push({ type: 'text', content: content.slice(lastIndex) });
      }

      if (parts.length === 0) {
        return `<div class="message-text">${escapeHtml(content)}</div>`;
      }

      return parts.map(part => {
        if (part.type === 'code') {
          const escapedCode = escapeHtml(part.content);
          return `
            <div class="code-header">
              <span class="code-lang">${part.language}</span>
              <button class="copy-btn" onclick="copyCode(this, \`${escapedCode.replace(/`/g, '\\`')}\`)">
                üìã –•—É—É–ª–∞—Ö
              </button>
            </div>
            <div class="code-block">${escapedCode}</div>
          `;
        }
        return `<div class="message-text">${escapeHtml(part.content)}</div>`;
      }).join('');
    }

    function copyCode(btn, code) {
      navigator.clipboard.writeText(code);
      btn.textContent = '‚úì –•—É—É–ª–∞–≥–¥–ª–∞–∞';
      setTimeout(() => { btn.textContent = 'üìã –•—É—É–ª–∞—Ö'; }, 2000);
    }

    function renderMessages() {
      const container = document.getElementById('messages');
      const emptyState = document.getElementById('emptyState');
      
      if (messages.length === 0) {
        emptyState.style.display = 'block';
        return;
      }
      
      emptyState.style.display = 'none';
      
      let html = '';
      messages.forEach(msg => {
        const avatarColor = msg.role === 'user' ? 'user' : (msg.error ? 'error' : 'assistant');
        const avatar = msg.role === 'user' ? 'üë§' : 'ü§ñ';
        
        html += `
          <div class="message ${msg.role} ${msg.error ? 'error' : ''}">
            <div class="message-avatar">${avatar}</div>
            <div class="message-content">
              <div class="message-bubble">
                ${formatMessage(msg.content)}
                <div class="message-time">
                  ${new Date(msg.timestamp).toLocaleTimeString('mn-MN')}
                </div>
              </div>
            </div>
          </div>
        `;
      });
      
      container.innerHTML = html;
      container.scrollTop = container.scrollHeight;
    }

    function escapeHtml(text) {
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }

    function clearChat() {
      if (confirm('–ë“Ø—Ö –º–µ—Å—Å–µ–∂–∏–π–≥ —É—Å—Ç–≥–∞—Ö —É—É?')) {
        messages = [];
        localStorage.removeItem('claude_messages');
        renderMessages();
      }
    }
  </script>
  <script>
const KEY = 'workerUrl';
const DEFAULT_WORKER_URL = 'https://<–¢–ê–ù–´-WORKER>.oyunsanaa-ai.workers.dev/api/chat'; // ‚Üê –≠–ù–î –ó”®–í URL-–∞–∞ –±–∏—á

function getWorkerUrl() {
  let u = localStorage.getItem(KEY);
  if (!u) {
    // –∞–Ω—Ö —É–¥–∞–∞ –±–æ–ª default-–æ–æ –∞—à–∏–≥–ª–∞–∞–¥ —Ö–∞–¥–≥–∞–ª–Ω–∞
    localStorage.setItem(KEY, DEFAULT_WORKER_URL);
    u = DEFAULT_WORKER_URL;
  }
  return u;
}

function resetWorkerUrl() {
  const u = prompt('Cloudflare Worker URL (/api/chat):', localStorage.getItem(KEY) || DEFAULT_WORKER_URL);
  if (u) localStorage.setItem(KEY, u.trim());
  location.reload();
}

// UI –¥–æ—Ç—Ä–æ–æ ‚Äú‚öôÔ∏è –¢–æ—Ö–∏—Ä–≥–æ–æ‚Äù —Ç–æ–≤—á –Ω—ç–º—á–∏—Ö (—ç—Å–≤—ç–ª –æ–¥–æ–æ –±–∞–π–≥–∞–∞ —Ç–æ–≤—á—Ç–æ–π –Ω—å —Ö–æ–ª–±–æ—á–∏—Ö)
document.addEventListener('DOMContentLoaded', ()=>{
  const gear = document.createElement('button');
  gear.textContent = '‚öôÔ∏è –¢–æ—Ö–∏—Ä–≥–æ–æ';
  gear.onclick = resetWorkerUrl;
  document.body.appendChild(gear);
});

// fetch –¥—É—É–¥–ª–∞–≥–∞–¥ —Ö—ç—Ä—ç–≥–ª—ç:
async function callClaude(payload){
  const url = getWorkerUrl();
  const r = await fetch(url, { method:'POST', headers:{'content-type':'application/json'}, body: JSON.stringify(payload) });
  if (!r.ok) { alert('Worker URL –±—É—Ä—É—É —ç—Å–≤—ç–ª API –∞–ª–¥–∞–∞. ‚öôÔ∏è –¥–∞—Ä–∂ URL-–∞–∞ —à–∞–ª–≥–∞–Ω–∞ —É—É.'); resetWorkerUrl(); return; }
  return r;
}
</script>
</body>
</html>
